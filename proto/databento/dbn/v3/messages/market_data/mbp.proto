syntax = "proto3";

package databento.dbn.v3.messages.market_data;

import "databento/dbn/v3/common/header.proto";
import "databento/dbn/v3/common/price_levels.proto";
import "databento/dbn/v3/enums/action.proto";
import "databento/dbn/v3/enums/side.proto";

option go_package = "github.com/databento/dbn/gen/go/databento/dbn/v3/messages/market_data";
option java_multiple_files = true;
option java_package = "com.databento.dbn.v3.messages.market_data";

// Mbp1Msg represents market-by-price with depth 1.
// Binary layout: 104 bytes, 8-byte aligned
// RType: 0x01 (MBP_1)
message Mbp1Msg {
  // Common record header (16 bytes)
  databento.dbn.v3.common.RecordHeader hd = 1;

  // Event price (i64, fixed-width, signed)
  // Fixed-point: divide by 1,000,000,000 to get decimal price
  sfixed64 price = 2;

  // Event quantity (u32, fixed-width)
  fixed32 size = 3;

  // Book update action (c_char in binary)
  databento.dbn.v3.enums.Action action = 4;

  // Market side (c_char in binary)
  databento.dbn.v3.enums.Side side = 5;

  // Event flags bit field (u8 in binary, packed as u32)
  uint32 flags = 6;

  // Book depth level (u8 in binary, packed as u32)
  uint32 depth = 7;

  // Capture-server-received timestamp (u64, fixed-width)
  // UNIX epoch nanoseconds
  fixed64 ts_recv = 8;

  // Matching-engine-sending timestamp delta (i32, signed fixed-width)
  // Nanoseconds before ts_recv
  sfixed32 ts_in_delta = 9;

  // Message sequence number (u32, fixed-width)
  fixed32 sequence = 10;

  // Top of book price levels (fixed array: 1 level, 32 bytes)
  // In protobuf: repeated, in binary: fixed array [BidAskPair; 1]
  repeated databento.dbn.v3.common.BidAskPair levels = 11;
}

// Mbp10Msg represents market-by-price with depth 10.
// Binary layout: 424 bytes, 8-byte aligned
// RType: 0x0A (MBP_10)
message Mbp10Msg {
  // Common record header (16 bytes)
  databento.dbn.v3.common.RecordHeader hd = 1;

  // Event price (i64, fixed-width, signed)
  // Fixed-point: divide by 1,000,000,000 to get decimal price
  sfixed64 price = 2;

  // Event quantity (u32, fixed-width)
  fixed32 size = 3;

  // Book update action (c_char in binary)
  databento.dbn.v3.enums.Action action = 4;

  // Market side (c_char in binary)
  databento.dbn.v3.enums.Side side = 5;

  // Event flags bit field (u8 in binary, packed as u32)
  uint32 flags = 6;

  // Book depth level (u8 in binary, packed as u32)
  uint32 depth = 7;

  // Capture-server-received timestamp (u64, fixed-width)
  // UNIX epoch nanoseconds
  fixed64 ts_recv = 8;

  // Matching-engine-sending timestamp delta (i32, signed fixed-width)
  // Nanoseconds before ts_recv
  sfixed32 ts_in_delta = 9;

  // Message sequence number (u32, fixed-width)
  fixed32 sequence = 10;

  // Top 10 price levels (fixed array: 10 levels, 320 bytes)
  // In protobuf: repeated, in binary: fixed array [BidAskPair; 10]
  repeated databento.dbn.v3.common.BidAskPair levels = 11;
}
