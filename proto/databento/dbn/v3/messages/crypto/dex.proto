syntax = "proto3";

package databento.dbn.v3.messages.crypto;

import "databento/dbn/v3/common/header.proto";

option go_package = "github.com/databento/dbn/gen/go/databento/dbn/v3/messages/crypto";
option java_multiple_files = true;
option java_package = "com.databento.dbn.v3.messages.crypto";

// DexSwapMsg represents an on-chain AMM swap execution.
// Binary layout: 128 bytes, 8-byte aligned
// RType: 0xD4 (212)
message DexSwapMsg {
  databento.dbn.v3.common.RecordHeader hd = 1;
  fixed64 ts_recv = 2;

  // On-chain metadata
  fixed64 block_number = 3;
  fixed64 block_timestamp = 4;
  bytes tx_hash = 5; // 32-byte transaction hash
  fixed32 log_index = 6;

  // Swap details (fixed-point, scale 1e-9)
  sfixed64 amount_in = 7;
  sfixed64 amount_out = 8;
  sfixed64 fee = 9;
  sfixed64 price_before = 10;
  sfixed64 price_after = 11;

  // Pool and router addresses (20-byte Ethereum-style addresses)
  bytes pool_address = 12;
  bytes router_address = 13;

  // Sender/recipient (hashed identifiers)
  fixed64 sender_hash = 14;
  fixed64 recipient_hash = 15;

  // Gas metrics
  fixed32 gas_used = 16;
  fixed32 gas_price = 17; // Gas price in Gwei or 1e-9 scale
}

// DexPoolStateMsg represents an AMM pool state snapshot.
// Binary layout: 144 bytes, 8-byte aligned
// RType: 0xD5 (213)
message DexPoolStateMsg {
  databento.dbn.v3.common.RecordHeader hd = 1;
  fixed64 ts_recv = 2;

  // On-chain metadata
  fixed64 block_number = 3;
  fixed64 block_timestamp = 4;

  // Pool state (AMM)
  sfixed64 reserve0 = 5;
  sfixed64 reserve1 = 6;
  sfixed64 k_value = 7;
  sfixed64 sqrt_price_x96 = 8;
  sfixed64 liquidity = 9;
  sfixed32 tick = 10;

  // Pool metadata
  bytes pool_address = 11;
  uint32 pool_type = 12; // 1=UniV2, 2=UniV3, 3=Curve, etc.
  fixed32 fee_tier = 13; // Fee in basis points (e.g., 30 = 0.30%)

  // Volume stats (optional)
  sfixed64 volume_24h_token0 = 14;
  sfixed64 volume_24h_token1 = 15;
  sfixed64 fee_24h = 16;

  // TVL
  sfixed64 tvl_usd = 17;

  // Message sequence number (u32, fixed-width)
  fixed32 sequence = 18;
}
