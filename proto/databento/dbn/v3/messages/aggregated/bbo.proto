syntax = "proto3";

package databento.dbn.v3.messages.aggregated;

import "databento/dbn/v3/common/header.proto";
import "databento/dbn/v3/common/price_levels.proto";
import "databento/dbn/v3/enums/side.proto";

option go_package = "github.com/databento/dbn/gen/go/databento/dbn/v3/messages/aggregated";
option java_multiple_files = true;
option java_package = "com.databento.dbn.v3.messages.aggregated";

// BboMsg represents Best Bid/Offer snapshots.
// Binary layout: 72 bytes, 8-byte aligned
// RTypes: BBO_1S (0xC3), BBO_1M (0xC4)
message BboMsg {
  // Common record header (16 bytes)
  databento.dbn.v3.common.RecordHeader hd = 1;

  // Last trade price (i64, fixed-width, signed)
  // Fixed-point: divide by 1,000,000,000 to get decimal price
  sfixed64 price = 2;

  // Last trade quantity (u32, fixed-width)
  fixed32 size = 3;

  // Last trade aggressor side (c_char in binary)
  databento.dbn.v3.enums.Side side = 4;

  // Event flags bit field (u8 in binary, packed as u32)
  uint32 flags = 5;

  // End of interval timestamp (u64, fixed-width)
  // UNIX epoch nanoseconds
  fixed64 ts_recv = 6;

  // Message sequence number (u32, fixed-width)
  fixed32 sequence = 7;

  // Best bid/ask price level (fixed: 1 level, 32 bytes)
  // In protobuf: single message, in binary: [BidAskPair; 1]
  databento.dbn.v3.common.BidAskPair levels = 8;
}
